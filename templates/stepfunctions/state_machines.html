{% extends "base.html" %} {% block title %}Step Functions - LocalStack UI{%
endblock %} {% block content %}
<div class="container">
  <div class="level">
    <div class="level-left">
      <div class="level-item">
        <h1 class="title">
          <i class="fas fa-project-diagram"></i>&nbsp;Step Functions
        </h1>
      </div>
    </div>
    <div class="level-right">
      <div class="level-item">
        <form method="get" class="field has-addons">
          <div class="control">
            <input
              class="input"
              type="text"
              name="search"
              placeholder="Search state machines..."
              value="{{ search_query or '' }}"
            />
          </div>
          <div class="control">
            <button type="submit" class="button is-info">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  {% if error_message %}
  <div class="notification is-danger">
    <button class="delete"></button>
    <strong>Error:</strong> {{ error_message }}
  </div>
  {% endif %} {% if search_query %}
  <div class="notification is-info">
    <button class="delete"></button>
    Found <strong>{{ state_machines|length }}</strong> state machine(s) matching
    "{{ search_query }}"
    <a
      href="{{ url_for('stepfunctions_state_machines') }}"
      class="button is-small is-light ml-2"
    >
      Clear Search
    </a>
  </div>
  {% endif %} {% if state_machines %}
  <div class="columns is-multiline">
    {% for sm in state_machines %}
    <div class="column is-6">
      <div class="card">
        <div class="card-content">
          <div class="media">
            <div class="media-left">
              <figure class="image is-48x48">
                <span class="icon is-large has-text-success">
                  <i class="fas fa-project-diagram fa-2x"></i>
                </span>
              </figure>
            </div>
            <div class="media-content">
              <p class="title is-4">{{ sm.name }}</p>
              <p class="subtitle is-6">
                {{ sm.type }} {% if sm.status != 'ACTIVE' %}
                <span class="tag is-warning">{{ sm.status }}</span>
                {% else %}
                <span class="tag is-success">{{ sm.status }}</span>
                {% endif %}
              </p>
            </div>
          </div>

          <div class="content">
            <div class="field">
              <label class="label is-small">ARN</label>
              <code class="is-size-7 has-text-grey">{{ sm.arn }}</code>
            </div>

            <div class="tags">
              <span class="tag is-light">
                <i class="fas fa-calendar"></i>&nbsp;{{
                format_date(sm.creation_date) }}
              </span>
              <span class="tag is-light">
                <i class="fas fa-cogs"></i>&nbsp;{{ sm.type }}
              </span>
            </div>

            <div class="level is-mobile mt-3">
              <div class="level-left">
                <div class="level-item">
                  <small class="has-text-grey">
                    Created: {{ format_date(sm.creation_date) }}
                  </small>
                </div>
              </div>
              <div class="level-right">
                <div class="level-item">
                  <a
                    href="{{ url_for('stepfunctions_state_machine_detail', state_machine_arn=sm.arn) }}"
                    class="button is-small is-info"
                  >
                    <i class="fas fa-eye"></i>&nbsp;View Details
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="level">
    <div class="level-left">
      <div class="level-item">
        <p class="has-text-grey">
          {{ state_machines|length }} state machine(s) found
        </p>
      </div>
    </div>
  </div>
  {% else %}
  <div class="notification is-info">
    <div class="content">
      <h4>
        {% if search_query %} No State Machines Found {% else %} No Step
        Functions State Machines {% endif %}
      </h4>
      <p>
        {% if search_query %} No Step Functions state machines match your search
        query "{{ search_query }}".
        <a href="{{ url_for('stepfunctions_state_machines') }}"
          >Show all state machines</a
        >
        {% else %} There are no Step Functions state machines in this LocalStack
        instance yet. {% endif %}
      </p>
    </div>
  </div>
  {% endif %}

  <div class="notification is-light">
    <div class="content">
      <h5>About Step Functions</h5>
      <ul>
        <li>
          This is a read-only view of Step Functions state machines in
          LocalStack
        </li>
        <li>
          View state machine definitions, recent executions, and configuration
          details
        </li>
        <li>
          Use the search box to filter state machines by name, type, or status
        </li>
        <li>
          Click "View Details" to see the complete state machine definition and
          execution history
        </li>
      </ul>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      // Auto-hide notifications
      const notifications = document.querySelectorAll('.notification .delete');
      notifications.forEach((deleteButton) => {
          deleteButton.addEventListener('click', () => {
              deleteButton.parentElement.remove();
          });
      });

      // Auto-submit search form on input
      const searchInput = document.querySelector('input[name="search"]');
      if (searchInput) {
          let searchTimeout;
          searchInput.addEventListener('input', (e) => {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                  if (e.target.value !== '{{ search_query or '' }}') {
                      e.target.form.submit();
                  }
              }, 500);
          });
      }
  });
</script>
{% endblock %}
