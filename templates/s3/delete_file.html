{% extends "base.html" %}

{% block title %}Delete File - LocalStack UI{% endblock %}

{% block content %}
<div class="container">
    <nav class="breadcrumb" aria-label="breadcrumbs">
        <ul>
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('s3_buckets') }}">S3 Buckets</a></li>
            <li><a href="{{ url_for('s3_bucket_contents', bucket_name=bucket_name) }}">{{ bucket_name }}</a></li>
            <li class="is-active"><a href="#" aria-current="page">Delete File</a></li>
        </ul>
    </nav>

    <div class="level">
        <div class="level-left">
            <div class="level-item">
                <h1 class="title has-text-danger">
                    <i class="fas fa-trash"></i>&nbsp;Delete File
                </h1>
            </div>
        </div>
    </div>

    {% if error_message %}
    <div class="notification is-danger">
        <button class="delete"></button>
        <strong>Error:</strong> {{ error_message }}
    </div>
    {% endif %}

    <div class="columns">
        <div class="column is-two-thirds">
            <div class="notification is-warning">
                <h4 class="title is-4">
                    <i class="fas fa-exclamation-triangle"></i>&nbsp;Confirm File Deletion
                </h4>
                <div class="content">
                    <p>
                        You are about to permanently delete the file 
                        <strong>{{ file_key }}</strong> from bucket <strong>{{ bucket_name }}</strong>.
                    </p>
                    <p>
                        <strong>Warning:</strong> This action cannot be undone. The file will be permanently removed from the bucket.
                    </p>
                </div>
            </div>

            <div class="box">
                <div class="field">
                    <label class="label">Bucket</label>
                    <div class="control">
                        <input class="input" type="text" value="{{ bucket_name }}" readonly>
                    </div>
                </div>

                <div class="field">
                    <label class="label">File to Delete</label>
                    <div class="control">
                        <input class="input" type="text" value="{{ file_key }}" readonly>
                    </div>
                </div>

                <div class="field is-grouped">
                    <div class="control">
                        <form method="post" style="display: inline;">
                            <button type="submit" class="button is-danger">
                                <i class="fas fa-trash"></i>&nbsp;Yes, Delete File
                            </button>
                        </form>
                    </div>
                    <div class="control">
                        <a href="{{ url_for('s3_bucket_contents', bucket_name=bucket_name) }}" class="button is-light">
                            <i class="fas fa-times"></i>&nbsp;Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="column is-one-third">
            <div class="notification is-light">
                <h5 class="title is-5">What Happens Next?</h5>
                <div class="content">
                    <ol>
                        <li>The file will be permanently deleted from the S3 bucket</li>
                        <li>You'll be redirected back to the bucket contents</li>
                        <li>The file will no longer be accessible</li>
                        <li>This action cannot be reversed</li>
                    </ol>
                </div>
            </div>

            <div class="notification is-info">
                <h6 class="title is-6">Alternative Options</h6>
                <div class="content">
                    <p>
                        Instead of deleting, you could:
                    </p>
                    <ul>
                        <li>Download the file first as a backup</li>
                        <li>Rename it by uploading with a new name</li>
                        <li>Move it to a different bucket</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Auto-hide notifications
        const notifications = document.querySelectorAll('.notification .delete');
        notifications.forEach((deleteButton) => {
            deleteButton.addEventListener('click', () => {
                deleteButton.parentElement.remove();
            });
        });

        // Add confirmation to delete button
        const deleteForm = document.querySelector('form[method="post"]');
        if (deleteForm) {
            deleteForm.addEventListener('submit', (e) => {
                const confirmed = confirm(
                    'Are you absolutely sure you want to delete this file? This action cannot be undone.'
                );
                if (!confirmed) {
                    e.preventDefault();
                }
            });
        }
    });
</script>
{% endblock %}